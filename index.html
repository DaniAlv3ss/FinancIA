<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Financeiro</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple transition for view switching */
        .view {
            display: none;
            animation: fadeIn 0.5s;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        #app-view { display: none; }
        .modal {
            display: none;
            animation: fadeIn 0.3s;
        }
        .modal.active {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- Login View -->
    <div id="login-view" class="flex items-center justify-center h-screen w-screen">
        <div class="text-center bg-gray-800 p-10 rounded-xl shadow-2xl border border-gray-700 max-w-sm mx-4">
            <h1 class="text-3xl font-bold text-white mb-2">Dashboard Financeiro</h1>
            <p class="text-gray-400 mb-6">Entre com sua conta ou registre-se.</p>
            
            <form id="email-form" class="space-y-4 mb-4">
                <input type="email" id="email" placeholder="Seu e-mail" required class="w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500 p-3">
                <input type="password" id="password" placeholder="Sua senha" required class="w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500 p-3">
                <div class="flex gap-4">
                    <button type="button" id="email-signin-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Entrar</button>
                    <button type="button" id="email-signup-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Registrar</button>
                </div>
            </form>

            <div class="flex items-center my-4">
                <hr class="flex-grow border-gray-600">
                <span class="px-4 text-gray-500 text-sm">OU</span>
                <hr class="flex-grow border-gray-600">
            </div>

            <button id="login-btn" class="flex items-center justify-center w-full bg-white text-gray-800 font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-gray-200 transition-colors duration-300 mb-4">
                <svg class="w-6 h-6 mr-3" viewBox="0 0 48 48"><defs><path id="a" d="M44.5 20H24v8.5h11.8C34.7 33.9 30.1 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 4.1 29.6 2 24 2 11.8 2 2 11.8 2 24s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.5-4z"/></defs><clipPath id="b"><use xlink:href="#a" overflow="visible"/></clipPath><path clip-path="url(#b)" fill="#FBBC05" d="M0 37V11l17 13z"/><path clip-path="url(#b)" fill="#EA4335" d="M0 11l17 13 7-6.1L48 14V0H0z"/><path clip-path="url(#b)" fill="#34A853" d="M0 37l30-23 7.9 1L48 0v48H0z"/><path clip-path="url(#b)" fill="#4285F4" d="M48 48L17 24l-4-3 35-10z"/></svg>
                Entrar com Google
            </button>
            <button id="anonymous-login-btn" class="text-green-400 hover:underline text-sm font-semibold">Continuar como convidado</button>
        </div>
    </div>

    <!-- App View -->
    <div id="app-view" class="flex w-full h-screen">
        <div id="menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>
        <aside id="sidebar" class="w-64 bg-gray-800 p-6 flex-shrink-0 fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-30 md:flex flex-col justify-between">
            <div>
                 <div class="flex items-center justify-between mb-8">
                    <h2 class="text-2xl font-bold text-white border-b-2 border-green-500 pb-2">MENU</h2>
                    <button id="close-menu-btn" class="md:hidden">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
                <nav id="main-menu">
                    <ul>
                        <li class="mb-4"><a href="#" onclick="showView('dashboard-view', this)" class="flex items-center p-3 rounded-lg bg-green-600 text-white font-bold shadow-md"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>Dashboard</a></li>
                        <li class="mb-4"><a href="#" onclick="showView('accounts-view', this)" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 8v-4m1-4h3"></path></svg>Contas</a></li>
                        <li class="mb-4"><a href="#" onclick="showView('transactions-view', this)" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>Transações</a></li>
                        <li class="mb-4"><a href="#" onclick="showView('recurring-view', this)" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5M4 4l5 5M20 20l-5-5"></path></svg>Recorrências</a></li>
                        <li class="mb-4"><a href="#" onclick="showView('cards-view', this)" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H4a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>Cartões</a></li>
                        <li class="mb-4"><a href="#" onclick="showView('investments-view', this)" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>Investimentos</a></li>
                        <li class="mb-4"><a href="#" onclick="showView('budgets-view', this)" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>Orçamentos</a></li>
                        <li class="mb-4"><a href="#" onclick="showView('settings-view', this)" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors duration-200"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>Configurações</a></li>
                    </ul>
                </nav>
            </div>
            <div id="user-profile" class="border-t border-gray-700 pt-4"></div>
        </aside>

        <div class="flex flex-col flex-1 w-full">
            <header class="md:hidden flex justify-between items-center p-4 bg-gray-800 sticky top-0 z-10 shadow-lg">
                <h1 class="text-xl font-bold text-white">Dashboard Financeiro</h1>
                <button id="hamburger-btn">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </header>

            <main class="flex-1 p-6 md:p-10 overflow-y-auto">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view active">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Dashboard Financeiro</h1><p class="text-gray-400">Bem-vindo! Aqui está um resumo das suas finanças.</p></header>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-gray-400 font-medium">Saldo Total</h3><p id="current-balance" class="text-3xl font-bold text-green-400 mt-2">R$ 0,00</p></div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-gray-400 font-medium">Receita Mensal</h3><p id="monthly-income" class="text-3xl font-bold text-white mt-2">R$ 0,00</p></div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-gray-400 font-medium">Despesa Mensal</h3><p id="monthly-expense" class="text-3xl font-bold text-white mt-2">R$ 0,00</p></div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-gray-400 font-medium">Economia do Mês</h3><p id="monthly-savings" class="text-3xl font-bold text-white mt-2">R$ 0,00</p></div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 md:col-span-2 lg:col-span-2"><h3 class="font-semibold text-white mb-4">Receitas vs. Despesas</h3><canvas id="lineChart"></canvas></div>
                        <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 md:col-span-2 lg:col-span-2"><h3 class="font-semibold text-white mb-4">Categorias de Gastos</h3><div class="max-h-80 mx-auto"><canvas id="pieChart"></canvas></div></div>
                    </div>
                </div>

                <!-- Accounts View -->
                <div id="accounts-view" class="view">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Minhas Contas</h1><p class="text-gray-400">Gerencie suas contas e saldos.</p></header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8">
                        <h3 class="text-xl font-bold text-white mb-4">Adicionar Nova Conta</h3>
                        <form id="account-form" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                            <div class="md:col-span-2"><label for="account-name" class="block text-sm font-medium text-gray-400">Nome da Conta</label><input type="text" id="account-name" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="account-balance" class="block text-sm font-medium text-gray-400">Saldo Inicial (R$)</label><input type="number" id="account-balance" step="0.01" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Adicionar Conta</button>
                        </form>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-xl font-bold text-white mb-4">Lista de Contas</h3><div id="accounts-list" class="space-y-4"></div></div>
                </div>

                <!-- Transactions View -->
                <div id="transactions-view" class="view">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Transações</h1><p class="text-gray-400">Adicione e gerencie suas receitas e despesas.</p></header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8">
                        <h3 class="text-xl font-bold text-white mb-4">Adicionar Nova Transação</h3>
                        <form id="transaction-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
                            <div class="lg:col-span-2"><label for="description" class="block text-sm font-medium text-gray-400">Descrição</label><input type="text" id="description" name="description" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="amount" class="block text-sm font-medium text-gray-400">Valor (R$)</label><input type="number" id="amount" name="amount" step="0.01" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="transaction-account" class="block text-sm font-medium text-gray-400">Conta</label><select id="transaction-account" name="transaction-account" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></select></div>
                            <div><label for="type" class="block text-sm font-medium text-gray-400">Tipo</label><select id="type" name="type" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"><option value="receita">Receita</option><option value="despesa">Despesa</option></select></div>
                            <div id="category-wrapper" class="hidden"><label for="transaction-category" class="block text-sm font-medium text-gray-400">Categoria</label><select id="transaction-category" name="transaction-category" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></select></div>
                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200 lg:col-start-5">Adicionar</button>
                        </form>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-xl font-bold text-white mb-4">Histórico de Transações</h3><div class="overflow-x-auto"><table class="min-w-full"><thead><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Descrição</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Conta</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Categoria</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Valor</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Data</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">Ações</th></tr></thead><tbody id="transaction-list"></tbody></table></div></div>
                </div>
                
                 <!-- Recurring View -->
                <div id="recurring-view" class="view">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Transações Recorrentes</h1><p class="text-gray-400">Automatize seus lançamentos fixos.</p></header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8">
                        <h3 class="text-xl font-bold text-white mb-4">Adicionar Recorrência</h3>
                        <form id="recurring-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                            <div class="lg:col-span-2"><label for="recurring-description" class="block text-sm font-medium text-gray-400">Descrição</label><input type="text" id="recurring-description" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="recurring-amount" class="block text-sm font-medium text-gray-400">Valor (R$)</label><input type="number" id="recurring-amount" step="0.01" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="recurring-type" class="block text-sm font-medium text-gray-400">Tipo</label><select id="recurring-type" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"><option value="receita">Receita</option><option value="despesa">Despesa</option></select></div>
                             <div><label for="recurring-account" class="block text-sm font-medium text-gray-400">Conta</label><select id="recurring-account" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></select></div>
                            <div id="recurring-category-wrapper" class="hidden"><label for="recurring-category" class="block text-sm font-medium text-gray-400">Categoria</label><select id="recurring-category" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></select></div>
                            <div><label for="recurring-day" class="block text-sm font-medium text-gray-400">Dia do Mês</label><input type="number" id="recurring-day" min="1" max="31" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Adicionar</button>
                        </form>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-xl font-bold text-white mb-4">Lista de Recorrências</h3><div id="recurring-list" class="space-y-4"></div></div>
                </div>

                <!-- Cards View -->
                <div id="cards-view" class="view">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Meus Cartões</h1><p class="text-gray-400">Gerencie seus cartões de crédito e débito.</p></header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8">
                        <h3 class="text-xl font-bold text-white mb-4">Adicionar Novo Cartão</h3>
                        <form id="card-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end">
                            <div><label for="card-bank-name" class="block text-sm font-medium text-gray-400">Nome do Banco</label><input type="text" id="card-bank-name" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="card-last-four" class="block text-sm font-medium text-gray-400">Últimos 4 dígitos</label><input type="text" id="card-last-four" required maxlength="4" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Adicionar Cartão</button>
                        </form>
                    </div><div id="cards-list" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                </div>

                <!-- Investments View -->
                <div id="investments-view" class="view">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Investimentos</h1><p class="text-gray-400">Acompanhe o desempenho da sua carteira.</p></header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 mb-8">
                        <h3 class="text-xl font-bold text-white mb-4">Adicionar Novo Ativo</h3>
                        <form id="investment-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 items-end">
                            <div><label for="investment-asset" class="block text-sm font-medium text-gray-400">Ativo</label><input type="text" id="investment-asset" placeholder="ex: PETR4, MXRF11" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="investment-type" class="block text-sm font-medium text-gray-400">Tipo</label><select id="investment-type" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"><option>Ação</option><option>FII</option><option>Renda Fixa</option><option>Cripto</option><option>Outro</option></select></div>
                            <div><label for="investment-quantity" class="block text-sm font-medium text-gray-400">Quantidade</label><input type="number" id="investment-quantity" step="any" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <div><label for="investment-value" class="block text-sm font-medium text-gray-400">Valor Investido (R$)</label><input type="number" id="investment-value" step="0.01" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Adicionar Ativo</button>
                        </form>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700"><h3 class="text-xl font-bold text-white mb-4">Minha Carteira</h3><div class="overflow-x-auto"><table class="min-w-full"><thead><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Ativo</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Tipo</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Quantidade</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Valor Investido</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider">Ações</th></tr></thead><tbody id="investment-list"></tbody></table></div></div>
                </div>

                <!-- Budgets View -->
                <div id="budgets-view" class="view">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Orçamentos Mensais</h1><p class="text-gray-400">Defina limites de gastos para suas categorias.</p></header>
                    <div id="budgets-list" class="space-y-6"></div>
                </div>

                <!-- Settings View -->
                <div id="settings-view" class="view">
                    <header class="mb-8"><h1 class="text-3xl font-bold text-white">Configurações</h1><p class="text-gray-400">Gerencie as configurações do seu aplicativo.</p></header>
                    <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                        <h3 class="text-xl font-bold text-white mb-4">Gerenciar Categorias de Despesa</h3>
                        <form id="category-form" class="flex items-end gap-4 mb-6">
                            <div class="flex-1"><label for="category-name" class="block text-sm font-medium text-gray-400">Nome da Categoria</label><input type="text" id="category-name" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">Adicionar</button>
                        </form>
                        <div id="category-list" class="space-y-3"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

     <!-- Edit Transaction Modal -->
    <div id="edit-transaction-modal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700 w-full max-w-lg mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-white">Editar Transação</h3>
                <button onclick="closeEditTransactionModal()" class="text-gray-400 hover:text-white">&times;</button>
            </div>
            <form id="edit-transaction-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                <input type="hidden" id="edit-transaction-id">
                <div class="md:col-span-2"><label for="edit-description" class="block text-sm font-medium text-gray-400">Descrição</label><input type="text" id="edit-description" name="description" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                <div><label for="edit-amount" class="block text-sm font-medium text-gray-400">Valor (R$)</label><input type="number" id="edit-amount" name="amount" step="0.01" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                <div><label for="edit-date" class="block text-sm font-medium text-gray-400">Data</label><input type="date" id="edit-date" name="date" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></div>
                <div><label for="edit-transaction-account" class="block text-sm font-medium text-gray-400">Conta</label><select id="edit-transaction-account" name="transaction-account" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></select></div>
                <div><label for="edit-type" class="block text-sm font-medium text-gray-400">Tipo</label><select id="edit-type" name="type" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"><option value="receita">Receita</option><option value="despesa">Despesa</option></select></div>
                <div id="edit-category-wrapper" class="hidden md:col-span-2"><label for="edit-transaction-category" class="block text-sm font-medium text-gray-400">Categoria</label><select id="edit-transaction-category" name="transaction-category" class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm text-white focus:ring-green-500 focus:border-green-500"></select></div>
                <div class="md:col-span-2 flex justify-end gap-4 mt-4">
                    <button type="button" onclick="closeEditTransactionModal()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-colors duration-200">Cancelar</button>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-md transition-colors duration-200">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, signInAnonymously, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, deleteDoc, onSnapshot, collection, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // App State
        let transactions = [], accounts = [], recurring = [], cards = [], investments = [], categories = [], budgets = {};
        let lineChart, pieChart;
        let db, auth, userId, appId;
        let unsubTransactions, unsubAccounts, unsubRecurring, unsubCards, unsubInvestments, unsubCategories, unsubBudgets;

        // --- Functions ---
        
        const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        
        const toggleMenu = () => {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
            document.getElementById('sidebar').classList.toggle('translate-x-0');
            document.getElementById('menu-overlay').classList.toggle('hidden');
        };

        // --- Functions exposed to window for HTML onclick handlers ---
        
        window.showView = (viewId, element) => {
            document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            
            document.querySelectorAll('#main-menu a').forEach(link => {
                link.classList.remove('bg-green-600', 'text-white', 'font-bold', 'shadow-md');
                link.classList.add('hover:bg-gray-700');
            });
            element.classList.add('bg-green-600', 'text-white', 'font-bold', 'shadow-md');
            element.classList.remove('hover:bg-gray-700');

            if (window.innerWidth < 768) {
                toggleMenu();
            }
        };

        const getEntityNameById = (collection, id) => (collection.find(item => item.id === id) || {}).name || 'N/A';

        // CRUD functions are now inside the module scope
        
        // --- Modal Functions ---
        window.openEditTransactionModal = (id) => {
            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;
            document.getElementById('edit-transaction-id').value = transaction.id;
            document.getElementById('edit-description').value = transaction.description;
            document.getElementById('edit-amount').value = transaction.amount;
            document.getElementById('edit-date').value = transaction.date;
            document.getElementById('edit-transaction-account').value = transaction.accountId;
            document.getElementById('edit-type').value = transaction.type;
            
            const categoryWrapper = document.getElementById('edit-category-wrapper');
            const categorySelect = document.getElementById('edit-transaction-category');
            if (transaction.type === 'despesa') {
                categoryWrapper.classList.remove('hidden');
                const category = categories.find(c => c.name === transaction.categoryName);
                if(category) categorySelect.value = category.id;
            } else {
                categoryWrapper.classList.add('hidden');
            }
            
            document.getElementById('edit-transaction-modal').classList.add('active');
        };

        window.closeEditTransactionModal = () => {
            document.getElementById('edit-transaction-modal').classList.remove('active');
        };

        // --- Firestore Operations ---
        
        async function updateTransaction(event) {
            event.preventDefault();
            if(!userId) return;
            const form = event.target;
            const id = form['edit-transaction-id'].value;
            const type = form['edit-type'].value;

            const updatedData = {
                description: form['edit-description'].value,
                amount: parseFloat(form['edit-amount'].value),
                date: form['edit-date'].value,
                accountId: form['edit-transaction-account'].value,
                type: type,
                categoryName: ''
            };

            if (type === 'despesa') {
                const select = form['edit-transaction-category'];
                if (select.value) {
                    updatedData.categoryName = select.options[select.selectedIndex].text;
                } else {
                    alert('Por favor, selecione uma categoria para a despesa.');
                    return;
                }
            }

            try {
                const docRef = doc(db, `/artifacts/${appId}/users/${userId}/transactions/${id}`);
                await updateDoc(docRef, updatedData);
                closeEditTransactionModal();
            } catch (error) {
                console.error("Error updating transaction:", error);
                alert("Erro ao atualizar transação.");
            }
        }
        
        // ... (rest of the functions for add/delete of other entities) ...

        // --- App Initialization ---

        window.onload = () => {
            // ... (rest of the onload function) ...
            try {
                const encodedConfig = "eyJhcGlLZXkiOiJBSXphU3lCN0JPVTBCQ0hOOUxTVXZ4QUsxaXBqYnRwMU9ja3M1eTQiLCJhdXRoRG9tYWluIjoiZmluYW5jYXMtOTcxZGIuZmlyZWJhc2VhcHAuY29tIiwicHJvamVjdElkIjoiZmluYW5jYXMtOTcxZGIiLCJzdG9yYWdlQnVja2V0IjoiZmluYW5jYXMtOTcxZGIuZmlyZWJhc2VzdG9yYWdlLmFwcCIsIm1lc3NhZ2luZ1NlbmRlcklkIjoiNzI1Mzc5OTcwMTYzIiwiYXBwSWQiOiIxOjcyNTM3OTk3MDE2MzpqZWI6OTAzZDRjMGE5MWVkODc5OWQ5MjYwNiIsIm1lYXN1cmVtZW50SWQiOiJHLVZMMEtaSFhDWUoifQ==";
                const firebaseConfig = JSON.parse(atob(encodedConfig));
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                appId = firebaseConfig.projectId;
                
                onAuthStateChanged(auth, (user) => {
                    const loginView = document.getElementById('login-view');
                    const appView = document.getElementById('app-view');
                    const userProfileDiv = document.getElementById('user-profile');

                    if (user) { 
                        userId = user.uid; 
                        loginView.style.display = 'none';
                        appView.style.display = 'flex';
                        
                        // ... (user profile rendering logic) ...

                        listenForFirebaseData();
                        checkRecurringTransactions();
                    } else {
                        // ... (logout logic) ...
                    }
                });
            } catch (e) {
                // ... (error handling) ...
            }
        };
    </script>
</body>
</html>

